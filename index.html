<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>PlayerSummary_Base preview</title>
  <style>
    body { font-family: system-ui, Arial; margin: 16px; }
    #status { margin-bottom: 12px; }
    label { font-weight: bold; margin-right: 8px; }
    select { margin-bottom: 12px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 6px; font-size: 12px; }
    th { background: #f6f6f6; text-align: left; position: sticky; top: 0; }
  </style>
</head>
<body>
  <h1>PlayerSummary_Base preview</h1>

  <label for="debutComp">DebutCompetition:
    <select id="debutComp"><option>(Loading…)</option></select>
  </label>

  <div id="status">Loading…</div>
  <table id="tbl"><thead id="thead"></thead><tbody id="tbody"></tbody></table>

  <script>
    async function loadCSV() {
      const csvUrl = './PlayerSummary_Base.csv';
      try {
        const res = await fetch(csvUrl);
        if (!res.ok) throw new Error('Fetch failed');
        const text = await res.text();

        const parseLine = (line) => {
          const out = []; let cur = ''; let inQ = false;
          for (let i = 0; i < line.length; i++) {
            const ch = line[i], nx = line[i+1];
            if (ch === '"' && inQ && nx === '"') { cur += '"'; i++; continue; }
            if (ch === '"') { inQ = !inQ; continue; }
            if (ch === ',' && !inQ) { out.push(cur); cur = ''; continue; }
            cur += ch;
          }
          out.push(cur);
          return out;
        };

        const lines = text.split(/\r?\n/).filter(l => l.length);
        const headers = parseLine(lines[0]);
        const rows = lines.slice(1).map(parseLine);

        const thead = document.getElementById('thead');
        const htr = document.createElement('tr');
        headers.forEach(h => { const th = document.createElement('th'); th.textContent = h; htr.appendChild(th); });
        thead.appendChild(htr);

        function renderTable(filteredRows) {
          const tbody = document.getElementById('tbody');
          tbody.innerHTML = '';
          filteredRows.slice(0, 300).forEach(r => {
            const tr = document.createElement('tr');
            r.forEach(c => { const td = document.createElement('td'); td.textContent = c; tr.appendChild(td); });
            tbody.appendChild(tr);
          });
          document.getElementById('status').textContent = `Loaded ${filteredRows.length} rows (showing first 300).`;
        }

        const compIndex = headers.indexOf('DebutCompetition');
        const select = document.getElementById('debutComp');

        if (compIndex >= 0) {
          const compSet = [...new Set(rows.map(r => r[compIndex]))].sort();
          select.innerHTML = '<option value="">(All)</option>' + compSet.map(c => `<option>${c}</option>`).join('');
          select.onchange = () => {
            const val = select.value;
            const filtered = val ? rows.filter(r => r[compIndex] === val) : rows;
            renderTable(filtered);
          };
        } else {
          select.innerHTML = '<option>(DebutCompetition column not found)</option>';
        }

        renderTable(rows);

      } catch (e) {
        document.getElementById('status').textContent = 'Error loading CSV.';
        document.getElementById('debutComp').innerHTML = '<option>(CSV load failed)</option>';
      }
    }

    loadCSV();
  </script>
</body>
</html>
